artists_sql = SELECT a.*, GROUP_CONCAT(g.name) as genres FROM artist a JOIN artist_genres_genre agg on agg.genres_id = a.id JOIN genre g on agg.genre_id = g.id GROUP BY a.id;
events_sql = SELECT e.id as event_id, e.name as event_name, e.start_time, e.end_time, b.id as billing_id, b.artist_id as artist_id, b.lineup_order, v.id as venue_id, v.postcode, v.description, v.thumb_image, v.name as venue_name, t.id as tour_id, t.name as tour_name, sp.id as seating_plan_id, sp.name as seating_plan_name FROM event e JOIN seating_plan sp on e.seating_plan_id = sp.id JOIN venue v on sp.venue_id = v.id join billing b on b.event_id = e.id LEFT OUTER JOIN tour t on b.tour_id = t.id;
login_sql = SELECT c.id as customer_id, c.title, c.forename, c.surname, c.telephone, c.mobile, c.line_1, line_2, c.town, c.county, c.postcode, c.country, c.thumb_image, c.created, l.id as login_id, l.email, l.token, l.registration_hash, p.name as permission FROM login l LEFT OUTER JOIN login_permissions_permission lp on lp.permissions_id = l.id LEFT OUTER JOIN permission p on lp.permission_id = p.id LEFT JOIN customer c on c.login_id = l.id WHERE l.email = ? AND l.token = ?;
account_sql = SELECT c.id as customer_id, c.title, c.forename, c.surname, c.telephone, c.mobile, c.line_1, c.line_2, c.town, c.county, c.postcode, c.country, c.thumb_image, c.created, l.id as login_id, l.email, l.token, l.registration_hash FROM login l LEFT JOIN customer c on c.login_id = l.id WHERE l.id = ?;
favourites_sql = SELECT * FROM favorite WHERE customer_id = ?;
insert_account_sql = INSERT INTO login (email, token, registration_hash) VALUES (?, ?, ?);
insert_customer_sql = INSERT INTO customer (title, forename, surname, telephone, mobile, line_1, line_2, town, county, postcode, country, thumb_image, created, login_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
insert_favourites_sql = INSERT INTO favorite (customer_id, artist_id, event_id, genre_id, venue_id) VALUES (?, ?, ?, ?, ?);
update_account_sql = UPDATE login l SET l.email = ?, l.token = ? WHERE l.id = ?;
update_customer_sql = UPDATE customer c SET c.title = ?, c.forename = ?, c.surname = ?, c.telephone = ?, c.mobile = ?, c.line1 = ?, c.line2 = ?, c.town = ?, c.county = ?, c.postcode = ?, c.country = ?, c.thumb_image = ? WHERE c.login_id = ?;
delete_favourites_sql = DELETE FROM favourite WHERE customer_id = ? AND id = ?;
country_sql = SELECT * FROM country;
title_sql = SELECT * FROM title;
insert_booking_sql = INSERT INTO booking (created, customer_id, event_id) VALUES (?, ?, ?);
insert_booking_seat_sql = UPDATE booking_seat SET booking_id = ? WHERE seating_area_id = ?;
cancel_booking_sql = UPDATE booking b SET b.cancelled = ? WHERE customer_id = ? AND b.id = ?;
clear_booking_seat_sql = UPDATE booking_seat bs SET bs.booking_id = NULL WHERE bs.booking_id = ?;
customer_bookings_sql = SELECT * FROM booking WHERE customer_id = ?;
event_seats_sql = SELECT e.id as event_id, sa.seating_plan_id as plan, sa.name, sa.parent_id as parent, bs.seating_area_id as id, sa.capacity - COUNT(bs.booking_id) as available FROM event e JOIN seating_plan sp ON sp.id = e.seating_plan_id JOIN seating_area sa ON sp.id = sa.seating_plan_id JOIN booking_seat bs ON sa.id = bs.seating_area_id WHERE e.id = ? GROUP BY bs.seating_area_id;
event_available_sql = SELECT COUNT(bs.id) - COUNT(bs.booking_id) as available FROM event e JOIN seating_plan sp ON sp.id = e.seating_plan_id JOIN seating_area sa ON sp.id = sa.seating_plan_id JOIN booking_seat bs ON sa.id = bs.seating_area_id WHERE e.id = ? GROUP BY e.id;
seat_grid_a_sql = SELECT e.id as event_id, sp.name as seating_plan_name FROM event e JOIN seating_plan sp ON sp.id = e.seating_plan_id WHERE e.id = ?;
seat_grid_b_sql = SELECT sa.id as seating_area_id, sa.name as sa_name, sa.parent_id as sa_parent FROM seating_plan sp JOIN seating_area sa ON sp.id = sa.seating_plan_id WHERE sp.id = ? AND sa.parent_id IS NULL;
seat_grid_c_sql = SELECT sa.id as seating_area_id, sa.name as sa_name, sa.parent_id as sa_parent FROM seating_plan sp JOIN seating_area sa ON sp.id = sa.seating_plan_id WHERE sa.parent_id = ?;